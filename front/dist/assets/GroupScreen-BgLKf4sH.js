import{u as I,j as e,d as p,B as w,k as ce,a as le,t as b,v as z,w as de,x as me,y as ue,z as pe}from"./index-tHbs8s1P.js";import{r as a}from"./vendor-DoS0LqYF.js";import{$ as he,C as fe,a as xe,F as ge,b as ye}from"./ChatHeader-Mp9NIS0o.js";import{u as je}from"./useUploadFile-BRrkyXN_.js";import{A as q}from"./arrow-left-BwJh6u4c.js";import{X as be}from"./x-CraZlvt7.js";import{F as C}from"./popup-CoJ1F_Xs.js";import{I as Ce}from"./image-CVEUQU1E.js";import{H as we}from"./Header_user-Coe8x07_.js";import"./chart-Bxe9v4kL.js";import"./lodash-CtiV8GMO.js";import"./url-C7Fa9dY1.js";import"./search-C6GrREbn.js";import"./useInfiniteQuery-DDoH_wXG.js";import"./SearchBar-DyPVO7OF.js";import"./index.esm2017-2Ae0-Grf.js";import"./firebase-CAjFJgPV.js";import"./share-2-BBJw-w4Z.js";import"./briefcase-business-FQq7Q9i0.js";const Ne=({setParticipents:n,setIsadd:c})=>{const[i,l]=a.useState([]),[m,y]=a.useState(),N=I(o=>o.presisted.user.uid);a.useEffect(()=>{(async()=>{const h=await p.get("/connection/"+N);y(h.data)})()},[]);const f=o=>{l(i.filter(h=>h._id!==o))},v=o=>{l([...i,o])},S=()=>{i.length<2&&w("Need At least Three members"),n([...i]),c(!1)};return e.jsxs("div",{className:"bg-user text-white flex flex-col w-[70vw] p-4 h-screen",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(q,{className:"mr-2"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Add group members"})]}),e.jsx("div",{className:"flex flex-wrap mb-4",children:i.map(o=>e.jsxs("div",{className:"flex items-center bg-lite_user rounded-full px-3 py-1 mr-2 mb-2",children:[e.jsx("span",{className:"w-6 h-6 overflow-hidden bg-gray-600 rounded-full mr-2",children:e.jsx("img",{src:o.profilePhoto||"https://cdn-icons-png.flaticon.com/128/3059/3059518.png",alt:""})}),e.jsx("span",{children:o.name}),e.jsx(be,{size:16,className:"ml-2 cursor-pointer",onClick:()=>f(o._id)})]},o.id))}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Type a name",className:"w-full bg-lite_user text-white p-2 rounded"})}),e.jsx("div",{className:"h-[60vh] overflow-scroll scrollbar-hide",children:m==null?void 0:m.map(o=>e.jsxs("div",{className:"flex items-center mb-4",onClick:()=>v(o.otherUser),children:[e.jsx("span",{className:"w-10 h-10 bg-gray-600 rounded-full overflow-hidden mr-3",children:e.jsx("img",{src:o.otherUser.profilePhoto||"https://cdn-icons-png.flaticon.com/128/3059/3059518.png",alt:""})}),e.jsx("div",{children:e.jsx("p",{children:o.otherUser.name})})]},o._id))}),e.jsx("div",{className:"flex justify-center",children:e.jsx(q,{onClick:S})})]})},ve=()=>{const{socket:n}=ce(),c=le(),i=I(t=>{var s;return(s=t.presisted)==null?void 0:s.user}),l=I(t=>{var s;return(s=t.presisted)==null?void 0:s.community});a.useState(null);const[m,y]=a.useState([]),[N,f]=a.useState(),[v,S]=a.useState(""),[o,h]=a.useState(!1),[k,D]=a.useState(""),[O,R]=a.useState(!1),[u,_]=a.useState(null),[G,A]=a.useState(""),[V,L]=a.useState(),[W,Se]=a.useState(),[P,U]=a.useState(),[X,F]=a.useState(0),[ke,J]=a.useState(),[$,K]=a.useState(null),[j,E]=a.useState(),[Q,B]=a.useState(!1),d=a.useRef(null),M=a.useRef(null),H=a.useRef(null),{uploadFile:T}=je();a.useEffect(()=>{M.current=new he({path:"/peerjs",host:"localhost",port:5e3}),n.on("typing",r=>{r==l.selectedGroup._id?R(!0):setIsNotpresentInChat(!0)}),n.on("stopTyping",r=>{r==l.selectedGroup._id?R(!1):setIsNotpresentInChat(!1)}),n.on("connectUser",r=>{setReceivingCall(!0),setCaller(r),f(!0)});const t=r=>{!d.current||d.current._id!=(r.response.chat._id||r.response.chat)?notification.includes(r)||c(setNotification(r.response)):c(b(r.response)),c(z(r.response))};n.on("messageRecieved",t),(async()=>{const r=await p.get(`/chat/group/chatList/${i.uid}`);c(de(r.data))})()},[]);const Y=async()=>{if(!(!n||!u))try{const t=await T(u,u.type.split("/")[0],F),s=await p.post("/chat/file",{caption:v,user:i.uid,chat:l.selectedGroup._id,uid:d._id,url:t[u.type.split("/")[0]],contentType:u.type.split("/")[0]});s.data.response.chat=d.current,n.emit("newChat",s.data),c(b(s.data.response)),S(""),_(null)}catch(t){console.error(t)}},Z=async()=>{var t;if(!(!n||!$))try{const s=`a_${Date.now()}.webm`,r=new File([$],s,{type:"audio/webm"}),x=await T(r,"audio",F),g=await p.post("/chat/file",{user:i,uid:d.current.uid,contentType:"audio",url:x.audio,caption:"",chat:(t=l.selectedGroup)==null?void 0:t._id});g.data.response.chat=d.current,n.emit("newChat",g.data),c(b(g.data.response))}catch(s){C(s.response.data.message?s.response.data.message:s.message)}},ee=async()=>{if(!(!n||!k.trim()))try{const t=await p.post("/chat/group/message",{content:k,user:i.uid,chat:d.current._id});c(b(t.data.response)),c(z(t.data.response)),n.emit("newChat",t.data),D("")}catch(t){C(t.response.data.message?t.response.data.message:t.message)}},te=async t=>{try{d.current=t;const s=await p.get(`/chat/community/${t._id}`);c(me(s==null?void 0:s.data)),c(ue(t)),n.emit("join chat",t._id),J([])}catch(s){C(s.response.data.message?s.response.data.message:s.message)}},se=async t=>{t.preventDefault();try{if(!G.trim()){w("Name is Required");return}if(m.length<2){w("Select Members");return}const s=j&&await T(j,"image",F),r=await p.post("/chat/group/create",{user:i.uid,groupName:G,groupDiscrip:P,communityPicture:s.image,participents:m.map(x=>x._id)});r!=null&&r.data&&(w("Group Created Successfully"),A(""),y([]),E(null),U(""),L(!1),c(pe(r.data)))}catch(s){C(s.response.data.message?s.response.data.message:s.message)}},re=()=>{f(!0)},ae=t=>{if(D(t.target.value),!W)return;o||(h(!0),n.emit("typing",l.selectedGroup._id));let s=new Date().getTime();var r=3e3;setTimeout(()=>{var x=new Date().getTime(),g=x-s;g>=r&&o&&(n.emit("stopTyping",l.selectedGroup._id),h(!1))},r)},oe=t=>{const s=t.target.files[0];s&&_(s)},ne=()=>{H.current.click()},ie=t=>{E(t.target.files[0])};return e.jsxs("div",{className:"flex h-[90vh] bg-white",children:[e.jsx(fe,{chats:l,user:i.uid,takeChat:te,which:"Community Chats"}),N?e.jsx("div",{className:"w-2/3",children:e.jsx(VideoCall,{socket:n,reciever:d.current,setMe:f,chat,user:i,peer:M.current,caller,receivingCall})}):e.jsx(e.Fragment,{children:d.current?e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx(xe,{reciever:d.current,call:re}),u?e.jsx(ge,{fileContent:u,closeFileContainer:()=>_(null),sendFile:Y,perSec:X}):e.jsx(ye,{from:"group",user:i.uid,chat:l.chatInGroup,isTyping:O,content:k,handleTyping:ae,sendMessage:ee,sendAudio:Z,handleFileClick:oe,setAudioBlob:K})]}):e.jsx("div",{className:"flex ",children:V?e.jsx("div",{className:" flex",children:Q?e.jsx(Ne,{setParticipents:y,setIsadd:B}):e.jsxs("form",{className:"form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",className:"block mb-1 text-sm font-semibold text-gray-400",children:"Community Name"}),e.jsx("input",{required:!0,name:"",value:G,onChange:t=>{A(t.target.value)},type:"text",className:"w-full px-4 py-3  bg-transparent border border-gray-700 rounded-md focus:outline-none focus:border-purple-400",placeholder:"Enter your Name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"textarea",className:"block mb-1 text-sm font-semibold text-gray-400",children:"Deiscription"}),e.jsx("textarea",{cols:"60",rows:"5",id:"textarea",value:P,name:"textarea",className:"w-full px-4 py-3 bg-transparent border border-gray-700 rounded-md resize-none focus:outline-none focus:border-purple-400",placeholder:"Enter your message",onChange:t=>U(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"textarea",className:"block mb-1 text-sm font-semibold text-gray-400",children:"Community Picture"}),e.jsx("input",{type:"file",style:{display:"none"},ref:H,onChange:ie}),e.jsxs("div",{className:"flex",children:[e.jsx(Ce,{onClick:ne}),j&&e.jsx("img",{className:"w-56 mx-4",src:URL.createObjectURL(j)}),e.jsx("label",{htmlFor:"textarea",className:"block mb-1 ml-10 text-sm font-semibold text-gray-400",onClick:()=>B(!0),children:"choose two connections"})]})]}),e.jsx("div",{children:m&&m.map(t=>e.jsx("p",{children:t.name}))}),e.jsx("button",{onClick:se,type:"submit",className:"self-start ml-10 flex items-center justify-center w-2/5 px-4 py-3 mt-2 text-sm font-semibold text-gray-400 bg-gray-700 border border-gray-700 rounded-md cursor-pointer hover:bg-white hover:text-gray-700",children:"Create"})]})}):e.jsx("div",{className:"flex items-center justify-center w-[70vw]",children:e.jsx("button",{className:"ml-10 flex items-center justify-center w-2/5  px-4 py-3 mt-2  text-sm font-semibold  text-gray-400 bg-gray-700 border border-gray-700 rounded-md cursor-pointer hover:bg-white hover:text-gray-700",onClick:()=>{L(!0)},children:"Create Group"})})})})]})},Ve=()=>e.jsxs("div",{className:"flex-row",children:[e.jsx(we,{}),e.jsx("div",{className:"flex-grow",children:e.jsx(ve,{})})]});export{Ve as default};
