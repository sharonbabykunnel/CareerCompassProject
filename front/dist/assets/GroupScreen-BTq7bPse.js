import{u as I,j as e,e as p,d as w,l as ce,a as le,v as b,w as z,x as de,y as ue,z as me,A as pe}from"./index-BfulgVQ3.js";import{r}from"./vendor-DoS0LqYF.js";import{$ as he,C as fe,a as xe,F as ge,b as ye}from"./ChatHeader-qtU4-FA7.js";import{u as je}from"./useUploadFile-CVp1E-MT.js";import{A as q}from"./arrow-left-DEGR9P28.js";import{X as be}from"./x-D2pczkxf.js";import{F as C}from"./popup-CMwNQmR-.js";import{I as Ce}from"./image-X5QNYdS2.js";import{H as we}from"./Header_user-DlSEnNXi.js";import"./chart-Bxe9v4kL.js";import"./lodash-CtiV8GMO.js";import"./search-BEqc-Ren.js";import"./useInfiniteQuery-TRtL14UB.js";import"./SearchBar-DsAbXLr3.js";import"./index.esm2017-DWcddl5D.js";import"./firebase-BNWmzrjJ.js";import"./share-2-C-SiDAsF.js";import"./briefcase-business-DVpVTjzf.js";const Ne=({setParticipents:n,setIsadd:c})=>{const[i,l]=r.useState([]),[u,y]=r.useState(),N=I(o=>o.presisted.user.uid);r.useEffect(()=>{(async()=>{const h=await p.get("/connection/"+N);y(h.data)})()},[]);const f=o=>{l(i.filter(h=>h._id!==o))},v=o=>{l([...i,o])},S=()=>{i.length<2&&w("Need At least Three members"),n([...i]),c(!1)};return e.jsxs("div",{className:"bg-user text-white flex flex-col w-[70vw] p-4 h-screen",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(q,{className:"mr-2"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Add group members"})]}),e.jsx("div",{className:"flex flex-wrap mb-4",children:i.map(o=>e.jsxs("div",{className:"flex items-center bg-lite_user rounded-full px-3 py-1 mr-2 mb-2",children:[e.jsx("span",{className:"w-6 h-6 overflow-hidden bg-gray-600 rounded-full mr-2",children:e.jsx("img",{src:o.profilePhoto||"https://cdn-icons-png.flaticon.com/128/3059/3059518.png",alt:""})}),e.jsx("span",{children:o.name}),e.jsx(be,{size:16,className:"ml-2 cursor-pointer",onClick:()=>f(o._id)})]},o.id))}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Type a name",className:"w-full bg-lite_user text-white p-2 rounded"})}),e.jsx("div",{className:"h-[60vh] overflow-scroll scrollbar-hide",children:u==null?void 0:u.map(o=>e.jsxs("div",{className:"flex items-center mb-4",onClick:()=>v(o.otherUser),children:[e.jsx("span",{className:"w-10 h-10 bg-gray-600 rounded-full overflow-hidden mr-3",children:e.jsx("img",{src:o.otherUser.profilePhoto||"https://cdn-icons-png.flaticon.com/128/3059/3059518.png",alt:""})}),e.jsx("div",{children:e.jsx("p",{children:o.otherUser.name})})]},o._id))}),e.jsx("div",{className:"flex justify-center",children:e.jsx(q,{onClick:S})})]})},ve=()=>{const{socket:n}=ce(),c=le(),i=I(t=>{var s;return(s=t.presisted)==null?void 0:s.user}),l=I(t=>{var s;return(s=t.presisted)==null?void 0:s.community});r.useState(null);const[u,y]=r.useState([]),[N,f]=r.useState(),[v,S]=r.useState(""),[o,h]=r.useState(!1),[_,D]=r.useState(""),[O,A]=r.useState(!1),[m,k]=r.useState(null),[G,R]=r.useState(""),[V,L]=r.useState(),[W,Se]=r.useState(),[P,U]=r.useState(),[X,F]=r.useState(0),[_e,J]=r.useState(),[$,K]=r.useState(null),[j,E]=r.useState(),[Q,B]=r.useState(!1),d=r.useRef(null),M=r.useRef(null),H=r.useRef(null),{uploadFile:T}=je();r.useEffect(()=>{M.current=new he({path:"/peerjs",host:"localhost",port:5e3}),n.on("typing",a=>{a==l.selectedGroup._id?A(!0):setIsNotpresentInChat(!0)}),n.on("stopTyping",a=>{a==l.selectedGroup._id?A(!1):setIsNotpresentInChat(!1)}),n.on("connectUser",a=>{setReceivingCall(!0),setCaller(a),f(!0)});const t=a=>{!d.current||d.current._id!=(a.response.chat._id||a.response.chat)?notification.includes(a)||c(setNotification(a.response)):c(b(a.response)),c(z(a.response))};n.on("messageRecieved",t),(async()=>{const a=await p.get(`/chat/group/chatList/${i.uid}`);c(de(a.data))})()},[]);const Y=async()=>{if(!(!n||!m))try{const t=await T(m,m.type.split("/")[0],F),s=await p.post("/chat/file",{caption:v,user:i.uid,chat:l.selectedGroup._id,uid:d._id,url:t[m.type.split("/")[0]],contentType:m.type.split("/")[0]});s.data.response.chat=d.current,n.emit("newChat",s.data),c(b(s.data.response)),S(""),k(null)}catch(t){console.error(t)}},Z=async()=>{var t;if(!(!n||!$))try{const s=`a_${Date.now()}.webm`,a=new File([$],s,{type:"audio/webm"}),x=await T(a,"audio",F),g=await p.post("/chat/file",{user:i,uid:d.current.uid,contentType:"audio",url:x.audio,caption:"",chat:(t=l.selectedGroup)==null?void 0:t._id});g.data.response.chat=d.current,n.emit("newChat",g.data),c(b(g.data.response))}catch(s){C(s.response.data.message?s.response.data.message:s.message)}},ee=async()=>{if(!(!n||!_.trim()))try{const t=await p.post("/chat/group/message",{content:_,user:i.uid,chat:d.current._id});c(b(t.data.response)),c(z(t.data.response)),n.emit("newChat",t.data),D("")}catch(t){C(t.response.data.message?t.response.data.message:t.message)}},te=async t=>{try{d.current=t;const s=await p.get(`/chat/community/${t._id}`);c(ue(s==null?void 0:s.data)),c(me(t)),n.emit("join chat",t._id),J([])}catch(s){C(s.response.data.message?s.response.data.message:s.message)}},se=async t=>{t.preventDefault();try{if(!G.trim()){w("Name is Required");return}if(u.length<2){w("Select Members");return}const s=j&&await T(j,"image",F),a=await p.post("/chat/group/create",{user:i.uid,groupName:G,groupDiscrip:P,communityPicture:s.image,participents:u.map(x=>x._id)});a!=null&&a.data&&(w("Group Created Successfully"),R(""),y([]),E(null),U(""),L(!1),c(pe(a.data)))}catch(s){C(s.response.data.message?s.response.data.message:s.message)}},ae=()=>{f(!0)},re=t=>{if(D(t.target.value),!W)return;o||(h(!0),n.emit("typing",l.selectedGroup._id));let s=new Date().getTime();var a=3e3;setTimeout(()=>{var x=new Date().getTime(),g=x-s;g>=a&&o&&(n.emit("stopTyping",l.selectedGroup._id),h(!1))},a)},oe=t=>{const s=t.target.files[0];s&&k(s)},ne=()=>{H.current.click()},ie=t=>{E(t.target.files[0])};return e.jsxs("div",{className:"flex h-[90vh] bg-white",children:[e.jsx(fe,{chats:l,user:i.uid,takeChat:te,which:"Community Chats"}),N?e.jsx("div",{className:"w-2/3",children:e.jsx(VideoCall,{socket:n,reciever:d.current,setMe:f,chat,user:i,peer:M.current,caller,receivingCall})}):e.jsx(e.Fragment,{children:d.current?e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx(xe,{reciever:d.current,call:ae}),m?e.jsx(ge,{fileContent:m,closeFileContainer:()=>k(null),sendFile:Y,perSec:X}):e.jsx(ye,{from:"group",user:i.uid,chat:l.chatInGroup,isTyping:O,content:_,handleTyping:re,sendMessage:ee,sendAudio:Z,handleFileClick:oe,setAudioBlob:K})]}):e.jsx("div",{className:"flex ",children:V?e.jsx("div",{className:" flex",children:Q?e.jsx(Ne,{setParticipents:y,setIsadd:B}):e.jsxs("form",{className:"form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",className:"block mb-1 text-sm font-semibold text-gray-400",children:"Community Name"}),e.jsx("input",{required:!0,name:"",value:G,onChange:t=>{R(t.target.value)},type:"text",className:"w-full px-4 py-3  bg-transparent border border-gray-700 rounded-md focus:outline-none focus:border-purple-400",placeholder:"Enter your Name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"textarea",className:"block mb-1 text-sm font-semibold text-gray-400",children:"Deiscription"}),e.jsx("textarea",{cols:"60",rows:"5",id:"textarea",value:P,name:"textarea",className:"w-full px-4 py-3 bg-transparent border border-gray-700 rounded-md resize-none focus:outline-none focus:border-purple-400",placeholder:"Enter your message",onChange:t=>U(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"textarea",className:"block mb-1 text-sm font-semibold text-gray-400",children:"Community Picture"}),e.jsx("input",{type:"file",style:{display:"none"},ref:H,onChange:ie}),e.jsxs("div",{className:"flex",children:[e.jsx(Ce,{onClick:ne}),j&&e.jsx("img",{className:"w-56 mx-4",src:URL.createObjectURL(j)}),e.jsx("label",{htmlFor:"textarea",className:"block mb-1 ml-10 text-sm font-semibold text-gray-400",onClick:()=>B(!0),children:"choose two connections"})]})]}),e.jsx("div",{children:u&&u.map(t=>e.jsx("p",{children:t.name}))}),e.jsx("button",{onClick:se,type:"submit",className:"self-start ml-10 flex items-center justify-center w-2/5 px-4 py-3 mt-2 text-sm font-semibold text-gray-400 bg-gray-700 border border-gray-700 rounded-md cursor-pointer hover:bg-white hover:text-gray-700",children:"Create"})]})}):e.jsx("div",{className:"flex items-center justify-center w-[70vw]",children:e.jsx("button",{className:"ml-10 flex items-center justify-center w-2/5  px-4 py-3 mt-2  text-sm font-semibold  text-gray-400 bg-gray-700 border border-gray-700 rounded-md cursor-pointer hover:bg-white hover:text-gray-700",onClick:()=>{L(!0)},children:"Create Group"})})})})]})},Oe=()=>e.jsxs("div",{className:"flex-row",children:[e.jsx(we,{}),e.jsx("div",{className:"flex-grow",children:e.jsx(ve,{})})]});export{Oe as default};
